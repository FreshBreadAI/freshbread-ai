<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homepage Roast Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<style>
/* Basic Reset & Variables */
:root {
    /* Freshbread.ai inspired color palette */
    --primary: #9d7f5e; /* Warm brown */
    --secondary: #e1c8a5; /* Soft beige */
    --accent: #d5ad8b; /* Warm peach */
    --text-dark: #3b2e25; /* Deep brown - almost black */
    --text-light: #7a6a63; /* Medium brown */
    --bg-light: #f8f5f2; /* Very light cream/beige */
    --border: #e3dcd5; /* Light beige border */
    --card-bg: #ffffff; /* White card background */
    --error: #e17c7c; /* Soft red */
    --success: #a3c9a8; /* Soft green */
    --warning: #e6c288; /* Soft amber */
    --font-sans: 'Inter', 'Archivo', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    
    /* Spacing & Radius */
    --radius-sm: 6px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --shadow-sm: 0 1px 2px rgba(59, 46, 37, 0.04), 0 1px 4px rgba(59, 46, 37, 0.04);
    --shadow-md: 0 4px 12px rgba(59, 46, 37, 0.08);
    --shadow-lg: 0 12px 24px rgba(59, 46, 37, 0.12);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    margin: 0;
    padding: 0;
    font-family: var(--font-sans);
    color: var(--text-dark);
    background-color: var(--bg-light);
}

body {
    /* Background will be inherited from the website */
    padding: 1.5rem;
    letter-spacing: -0.011em;
}

h1, h2, h3 {
    line-height: 1.2;
    margin-bottom: 1rem;
    font-weight: 600;
}

h1 {
    font-size: 2.5rem;
}

h2 {
    font-size: 1.8rem;
}

p {
    margin-bottom: 1rem;
}

a {
    color: var(--primary);
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

/* Container & Card Styles */
.container {
    max-width: 800px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.card {
    background-color: var(--card-bg);
    border-radius: var(--radius-md);
    padding: 1.75rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* Score Container with Green (High) Score */
.card.score-container {
    background: var(--card-bg);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    padding: 2rem;
    position: relative;
    overflow: hidden;
}

.card.score-container::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 40%;
    height: 5px;
    background: linear-gradient(to right, transparent, var(--secondary));
    border-top-right-radius: var(--radius-md);
}

.card.score-container.score-green {
    background: var(--card-bg);
    border-color: var(--border);
}

.card.score-container.score-green::after {
    background: linear-gradient(to right, transparent, var(--success));
}

.card.score-container.score-red {
    background: var(--card-bg);
    border-color: var(--border);
}

.card.score-container.score-red::after {
    background: linear-gradient(to right, transparent, var(--error));
}

.card.score-container.score-orange {
    background: var(--card-bg);
    border-color: var(--border);
}

.card.score-container.score-orange::after {
    background: linear-gradient(to right, transparent, var(--warning));
}

/* Minimalist icon styles */
.icon {
    display: inline-block;
    vertical-align: middle;
    color: #555;
    margin-right: 0.5em;
    height: 1em;
    width: 1em;
}

/* Make icons 50% larger in detailed analysis cards */
.detailed-analysis-card .icon {
    height: 1.5em;
    width: 1.5em;
    margin-right: 0.6em;
}

/* Highlight effect for cards when scrolled to via click */
.highlight-card {
    animation: card-highlight 2s ease-out;
}

@keyframes card-highlight {
    0% { box-shadow: 0 0 0 2px var(--accent); }
    70% { box-shadow: 0 0 0 2px var(--accent); }
    100% { box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); }
}

/* Header */
header {
    text-align: center;
    margin-bottom: 2rem;
}

header p {
    color: var(--text-light);
    font-size: 1.1rem;
}

/* Form Styles */
.form-container {
    margin-bottom: 2rem;
}

.input-group {
    display: flex;
}

.input-group input[type="url"] {
    flex-grow: 1;
    padding: 0.8rem 1rem;
    border: 1px solid var(--border);
    border-radius: 4px 0 0 4px;
    font-size: 1rem;
    min-width: 0; /* Fix flexbox overflow issue */
}

.input-group input[type="url"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

.input-group button {
    padding: 0.8rem 1.5rem;
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.2s ease;
    white-space: nowrap;
}

.input-group button:hover {
    background-color: var(--success);
    filter: brightness(0.95);
}

.input-group button i {
    margin-left: 0.5rem;
}

/* Error Message */
.error-message {
    color: var(--error);
    background-color: #fdd;
    border: 1px solid var(--error);
    padding: 0.8rem 1rem;
    border-radius: 4px;
    margin-top: 1rem;
    text-align: center;
    display: none; /* Hidden by default */
}

/* Loading Indicator */
.loading {
    text-align: center;
    padding: 2rem;
    display: none; /* Hidden by default */
}

.spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border-left-color: var(--primary);
    animation: spin 1s ease infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.loading p {
    color: var(--text-light);
}

/* Results Section */
#results {
    display: none; /* Hidden until results are ready */
}

/* Score Container Styles */
.score-container {
    text-align: center;
    padding: 2rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-radius: 8px;
}

.overall-score {
    font-size: 3.5rem;
    font-weight: bold;
    line-height: 1;
    margin-bottom: 0.5rem;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.score-label {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* Overall Score SVG Styles */
.card.score-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%; /* Full width card */
    height: auto;
    margin: 1rem auto;
    padding: 10px 20px 20px;
    background-color: #fff; /* White background like other cards */
    border-radius: 10px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.circular-chart {
    display: block;
    width: 100%;
    height: 100%;
    transform: rotate(-90deg); /* Start the circle from the top */
    position: relative;
}

.score-circle {
    display: block;
    width: 140px; /* Larger circle */
    height: 140px; 
    transform: rotate(-90deg); /* Start the circle from the top */
    position: relative;
    border-radius: 50%;
    filter: drop-shadow(0 2px 8px rgba(59, 46, 37, 0.06));
    margin: 0 auto;
}

.score-circle .bg {
    fill: rgba(240, 240, 240, 0.7); /* Slightly more visible background fill */
    stroke: rgba(220, 220, 220, 0.8); /* Light stroke for definition */
    stroke-width: 1px;
}

.score-circle .circle {
    fill: none;
    stroke-width: 7px; /* Thicker for better visibility */
    stroke-linecap: round; /* Round ends */
    transition: stroke-dashoffset 0.5s ease-out, stroke 0.3s ease; /* Smooth transitions */
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
}

/* Color overrides based on container class */
.score-container.score-red .circle {
    stroke: var(--error); /* Soft red for low scores */
}

.score-container.score-orange .circle {
    stroke: var(--warning); /* Soft amber for medium scores */
}

.score-container.score-green .circle {
    stroke: var(--success); /* Soft green for high scores */
}

.score-container.score-grey .circle {
    stroke: var(--border); /* Light grey for unknown/default */
}

.score-h1, h2, h3, h4, h5, h6 {
    margin-bottom: 1rem;
    line-height: 1.2;
    font-weight: 600;
    letter-spacing: -0.022em;
    color: var(--text-dark);
}

.score-heading {
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    text-align: center;
    letter-spacing: -0.02em;
}

.main-heading {
    font-size: 1.2rem;
    font-weight: 700;
    margin: 1.2rem 0 0.5rem 0;
    color: var(--text-dark);
    text-align: center;
    line-height: 1.18;
}

/* Two-column layout for overall score card */
.score-layout {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}

.score-column {
    flex: 1;
    min-width: 200px;
    display: flex;
    justify-content: center;
}

.screenshot-column {
    flex: 1;
    min-width: 200px;
    display: flex;
    justify-content: center;
}

/* Screenshot styles */
.screenshot-container {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.homepage-screenshot {
    max-height: 300px; /* Increased from 200px */
    max-width: 100%;
    object-fit: contain;
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.circle-score-container {
    position: relative;
    width: 130px;
    height: 130px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

.overall-score {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-weight: bold;
    z-index: 2; /* Ensure it's above the SVG */
    color: #000; /* Black text for better readability */
}

/* Category Score Circles Container */
.category-score-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem; /* Space below overall score */
    margin-bottom: 1.5rem;
}

/* Individual Circle Score Card */
.category-score-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.circle-indicator {
    width: 110px;
    height: 110px;
    position: relative;
    margin: 0 auto 0.75rem;
    cursor: pointer;
    transition: transform 0.25s ease, filter 0.25s ease;
    filter: drop-shadow(0 2px 6px rgba(59, 46, 37, 0.04));
}

.circle-indicator:hover {
    transform: scale(1.05) translateY(-2px);
    filter: drop-shadow(0 3px 8px rgba(59, 46, 37, 0.08));
}

.circle-indicator svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg); /* Start progress from top */
}

.circle-indicator circle {
    fill: none;
    stroke-width: 10;
}

.circle-indicator .bg {
    stroke: #eee;
}

.circle-indicator .progress {
    stroke-linecap: round;
    transition: stroke-dashoffset 1s ease-out;
}

/* Score Colors */
.circle-indicator.red .progress { stroke: var(--error); }
.circle-indicator.orange .progress { stroke: var(--accent); }
.circle-indicator.green .progress { stroke: var(--success); }

.score-value {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-weight: bold;
}

.category-name {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 500;
    margin-top: 0.25rem;
    letter-spacing: -0.01em;
}

/* Roast Card */
#roastCard .category-header {
    background-color: #f5f5f5;
    padding: 1rem;
    border-bottom: 1px solid var(--border);
}

#roastCard .category-title {
    font-weight: 600;
    font-size: 1.2rem;
}

.roast-quote {
    font-style: italic;
    padding: 1.5rem 0;
    font-size: 1.1rem;
    line-height: 1.7;
    text-align: center;
    border-bottom: 1px solid var(--border);
    margin-bottom: 1rem;
}

/* Share Buttons */
.share-buttons {
    text-align: center;
    padding: 0.5rem 0;
}

.share-button {
    background: none;
    border: 1px solid var(--border);
    border-radius: 50%;
    color: var(--text-light);
    cursor: pointer;
    font-size: 1rem;
    width: 40px;
    height: 40px;
    line-height: 40px;
    margin: 0 0.3rem;
    transition: all 0.2s ease;
}

.share-button:hover {
    background-color: #eee;
    color: var(--text-dark);
}

/* ICP Card */
#icpCard h2 {
    text-align: center;
    margin-bottom: 1rem;
}

#icpContent {
    text-align: center;
    font-size: 1.1rem;
    color: var(--text-light);
}

/* Detailed Analysis Cards (if used) */
#detailedCards .category-card {
    margin-bottom: 1.5rem;
}

#detailedCards .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background-color: #f8f8f8;
    border-bottom: 1px solid var(--border);
}

#detailedCards .category-title {
    font-weight: 600;
}

#detailedCards .category-score {
    font-weight: bold;
}

#detailedCards .category-content {
    padding: 1rem;
}

#detailedCards h4 {
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
}

#detailedCards p {
    color: var(--text-light);
    margin-bottom: 0.5rem;
}

/* Detailed Analysis Card Styles */
.detailed-analysis-card .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.75rem;
    background-color: var(--bg-light);
    border-bottom: 1px solid var(--border);
    border-top-left-radius: var(--radius-md);
    border-top-right-radius: var(--radius-md);
}

.detailed-analysis-card .category-title {
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--text-dark);
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
}

.detailed-analysis-card .category-score {
    font-weight: 600;
    padding: 0.25rem 0.7rem;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    color: white;
    letter-spacing: -0.01em;
    box-shadow: var(--shadow-sm);
}

.detailed-analysis-card .category-score.red { background-color: var(--error); }
.detailed-analysis-card .category-score.orange { background-color: var(--warning); }
.detailed-analysis-card .category-score.green { background-color: var(--success); }
.detailed-analysis-card .category-score.grey { background-color: var(--text-light); }

.detailed-content {
    display: flex;
    flex-wrap: wrap; /* Allow wrapping on small screens */
    padding: 1.75rem;
    gap: 2rem; /* Space between columns */
    background-color: var(--card-bg);
}

.analysis-column,
.recommendation-column {
    flex: 1 1 45%; /* Allow shrinking, basis ~45% */
    min-width: 250px; /* Prevent columns from becoming too narrow */
}

.recommendation-column {
    position: relative; /* For the overlay */
}

.detailed-content h4 {
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1rem;
    color: var(--text-dark);
    letter-spacing: -0.01em;
    position: relative;
    padding-bottom: 0.5rem;
}

.detailed-content h4:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 2rem;
    height: 2px;
    background-color: var(--secondary);
    border-radius: 1px;
}

.detailed-content .recommendation-column h4 {
    color: var(--text-dark); /* Match Analysis heading color */
}

.detailed-content p {
    color: var(--text-light);
    font-size: 0.95rem;
    line-height: 1.6;
}

/* Bullet list styling */
.bullet-list {
    list-style: none;
    padding-left: 1.2rem;
    margin: 0;
    color: var(--text-light);
    font-size: 0.95rem;
}

.bullet-list li {
    position: relative;
    padding-left: 0.8rem;
    margin-bottom: 0.8rem;
    line-height: 1.5;
}

.bullet-list li:before {
    content: '‚Ä¢';
    position: absolute;
    left: -0.8rem;
    color: var(--text-dark);
    font-weight: bold;
}

/* Apply blur to content within the blurred recommendation column */
.recommendation-column.blurred > .blurred-content,
.recommendation-column.blurred > .blurred-content > .bullet-list {
    filter: blur(5px);
    user-select: none; /* Prevent text selection */
    pointer-events: none; /* Prevent interaction */
}

.recommendation-column.blurred h4, .recommendation-column.blurred .not-blurred {
    filter: none !important;
    color: var(--text-dark) !important;
    opacity: 1 !important;
}

.gating-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.6); /* Semi-transparent white */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    border-radius: 0 0 8px 8px; /* Match card rounding if needed */
    padding: 1rem;
    opacity: 0; /* Hidden by default, shown when .blurred is active */
    transition: opacity 0.3s ease;
}

.blurred .gating-overlay {
    opacity: 1; /* Show overlay when blurred */
}

.lock-icon {
    font-size: 2rem;
    color: var(--error); /* Change color to red */
    margin-bottom: 1rem;
}

.cta-button.get-full-report-btn {
    background-color: var(--accent);
    color: white;
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.cta-button.get-full-report-btn:hover {
    background-color: #e0941c; /* Darker orange */
}

/* --- Multi-Stage Popup Form Styles --- */

.popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.75); /* Slightly darker overlay */
    display: none; /* Initially hidden */
    justify-content: center;
    align-items: center;
    z-index: 1000;
    padding: 20px;
    overflow-y: auto; /* Allow scrolling if content overflows viewport */
}

.popup-container {
    background-color: white;
    border-radius: 12px; /* Smoother radius */
    max-width: 550px; /* Optimal width for form */
    width: 100%;
    max-height: 90vh; /* Limit height */
    overflow: hidden; /* Let stages handle scroll if needed */
    position: relative;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    display: flex; /* Use flex for internal layout */
    flex-direction: column;
}

.popup-close {
    position: absolute;
    top: 6px;
    right: 8px;
    font-size: 1.75rem;
    font-weight: bold;
    color: var(--text-light); /* Match our color scheme */
    background: none;
    border: none;
    cursor: pointer;
    line-height: 1;
    padding: 8px;
    z-index: 10;
}

.popup-close:hover {
    color: #333;
}

/* Stage Styling */
.funnel-stage {
    display: none;
    padding: 30px 40px; /* More padding */
    text-align: center;
    flex-grow: 1; /* Allow stage to take available space */
    overflow-y: auto; /* Allow scroll within stage if needed */
}

.funnel-stage.active {
    display: block;
}

.funnel-stage h1 {
    font-size: 1.6rem; /* Slightly smaller H1 */
    margin-bottom: 1.5rem;
    color: var(--text-dark);
    font-weight: 600;
}

.stage-indicator {
    color: #999;
    margin-bottom: 15px;
    font-size: 0.85rem;
    font-weight: 500;
}

/* Option Buttons (Stages 1-3) */
.options-container {
    display: flex;
    flex-direction: column;
    gap: 12px; /* Slightly smaller gap */
    margin: 25px 0;
}

.option-button {
    background-color: #f0f0f0; /* Lighter background */
    color: var(--text-dark);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 20px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.2s, border-color 0.2s, transform 0.1s ease-out;
    display: flex;
    align-items: center;
    justify-content: center; /* Center text */
    text-align: center;
    font-weight: 500;
}

.option-button:hover {
    background-color: #e6e6e6;
    border-color: #ccc;
}

.option-button:active {
    transform: scale(0.98);
}

.option-button .emoji {
    margin-right: 10px;
    font-size: 1.1rem;
}

/* Form Fields (Stage 4) */
.form-container {
    margin: 25px 0;
    text-align: left;
}

.form-field {
    margin-bottom: 18px;
}

.form-field label {
    display: block;
    margin-bottom: 6px;
    font-size: 0.9rem;
    color: #555;
    font-weight: 500;
}

.form-field input[type="text"],
.form-field input[type="email"],
.form-field input[type="tel"],
.form-field select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-field input:focus,
.form-field select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
}

/* Phone Input Specifics */
.phone-input-container {
    display: flex;
}

.country-code-select {
    flex: 0 0 120px; /* Fixed width for dropdown */
    border-right: none;
    border-radius: 6px 0 0 6px;
    background-color: #f8f8f8;
    cursor: pointer;
}

.phone-input {
    flex: 1 1 auto; /* Allow phone input to grow */
    border-radius: 0 6px 6px 0 !important; /* Override */
}

/* Submit Button (Stage 4) */
.submit-button {
    background-color: var(--primary) !important;
    color: white !important; /* Force white text always */
    border: none !important;
    border-radius: 8px !important;
    padding: 14px 30px !important;
    font-size: 1.1rem !important;
    cursor: pointer !important;
    transition: background-color 0.2s, transform 0.1s ease-out !important;
    width: 100% !important;
    font-weight: 600 !important;
    margin-top: 10px !important;
    text-shadow: 0 1px 1px rgba(0,0,0,0.3) !important; /* Add text shadow for better visibility */
}

.submit-button:hover {
    background-color: #3a873a !important; /* Darker green on hover, hardcoded to prevent any inheritance issues */
    color: white !important; /* Force white text on hover */
    opacity: 1 !important; /* Ensure opacity is always 100% */
    filter: brightness(0.9) !important; /* Use brightness instead of opacity */
}

.submit-button:active {
    transform: scale(0.99) !important;
    color: white !important;
    background-color: #306a30 !important; /* Even darker on active */
}

/* Success Message/Screen */
.success-notification {
    background-color: var(--primary); /* Match button */
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: 600;
    /* Removed border-radius for seamless look with container */
    /* Initially hidden, shown via JS */
    display: none;
}

.success-container {
    text-align: center;
    padding: 40px 20px;
    /* Initially hidden, shown via JS */
    display: none;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.success-container h2 {
    font-size: 1.8rem;
    margin-bottom: 15px;
    color: var(--primary-dark);
}

.success-container p {
    font-size: 1rem;
    color: #666;
    margin-bottom: 20px;
}

/* Adjustments for when success message is shown */
.popup-container.success-mode #funnelContent {
    display: none;
}
.popup-container.success-mode .success-notification,
.popup-container.success-mode .success-container {
    display: block; /* Or flex for success-container if needed */
}

/* --- End Popup Form Styles --- */

/* Responsive adjustments */
@media (max-width: 768px) {
    .score-layout {
        flex-direction: column;
        align-items: center;
    }
    
    .score-column,
    .screenshot-column {
        width: 100%;
        max-width: 320px; /* Limit width on mobile */
    }
    
    /* Center the score circle better on mobile */
    .circle-score-container {
        margin: 0 auto 1.5rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    /* Make sure the score text is centered within the circle */
    .overall-score {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        width: auto;
    }
    
    /* Add more space between score and screenshot on mobile */
    .score-container {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    /* Ensure screenshot has proper spacing and is responsive */
    .screenshot-container {
        margin-top: 1.5rem;
        width: 100%;
        max-width: 300px;
    }
    
    /* Make sure score circle SVG is sized consistently */
    .score-circle {
        width: 120px;
        height: 120px;
    }
}

@media (max-width: 600px) {
    html, body {
        position: relative;
        height: auto;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
    }
    body {
        padding: 1rem;
        min-height: 100%;
    }
    .container {
        margin: 1rem auto;
        padding: 0;
        overflow: visible;
    }
    h1 {
        font-size: 2rem;
    }
    .input-group {
        flex-direction: column;
    }
    .input-group input[type="url"] {
        border-radius: 4px;
        margin-bottom: 0.5rem;
    }
    .input-group button {
        border-radius: 4px;
        width: 100%;
    }
    .category-score-cards {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 0.8rem;
    }
    .circle-indicator {
        width: 80px;
        height: 80px;
    }
    .score-value {
        font-size: 1.2rem;
    }
}

</style>

<body>
    <div class="container">
        <header>
            <h1>Homepage Roast</h1>
            <h1 class="main-heading">Transform Your Homepage from Missed Opportunity to Money-Making Machine</h1>
            <p class="main-subheading">Our Homepage Roast delivers brutal honesty and actionable fixes to boost conversions in under 1 minute</p>
        </header>
        
        <div class="card form-container">
            <form id="roastForm">
                <div class="input-group">
                    <input type="url" id="urlInput" placeholder="Enter your homepage URL (e.g., https://example.com)" required>
                    <button type="submit">Analyze <i class="fas fa-search"></i></button>
                </div>
            </form>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your homepage... This may take up to 30 seconds.</p>
        </div>
        
        <div id="results">
            <!-- Overall Score -->
            <div class="card score-container">
                <!-- Heading above the score -->
                <div class="score-heading">Overall Homepage Score</div>
                
                <!-- Two-column layout for score and screenshot -->
                <div class="score-layout">
                    <!-- Left column: Circle and score container -->
                    <div class="score-column">
                        <div class="circle-score-container">
                            <!-- SVG for Circular Progress -->
                            <svg class="score-circle" width="130" height="130" viewBox="0 0 120 120">
                                <defs>
                                    <linearGradient id="gradient-red" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FF8A8A; stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#FF4D4D; stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="gradient-orange" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FFD580; stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#FFA500; stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="gradient-green" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#81C784; stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#4CAF50; stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="bg" cx="60" cy="60" r="54"></circle>
                                <path class="circle" 
                                      d="M60,6 A54,54 0 0,1 60,114 A54,54 0 0,1 60,6" 
                                      stroke-linecap="round" 
                                      stroke-dasharray="339.29" 
                                      stroke-dashoffset="339.29"> 
                                </path>
                            </svg>
                            <!-- Score text display will be overlaid via CSS -->
                            <div class="overall-score" id="overallScore">?/10</div>
                        </div>
                    </div>
                    
                    <!-- Right column: Screenshot container -->
                    <div class="screenshot-column">
                        <div class="screenshot-container">
                            <img id="homepageScreenshot" src="" alt="Homepage Screenshot" class="homepage-screenshot">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Container for individual category score circles -->
            <div class="category-score-cards"></div> 
            
            <!-- Moved Roast Card -->
            <div class="card category-card" id="roastCard">
                <div class="category-header">
                    <div class="category-title">The Roast</div>
                </div>
                <div class="category-content">
                    <div class="roast-quote" id="roastContent"></div>
                    <div class="share-buttons">
                        <button class="share-button" id="shareTwitter" title="Share on Twitter">
                            <i class="fab fa-twitter"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ICP Card -->
            <div class="card" id="icpCard">
                <h2>It Looks Like Your Ideal Customers Are:</h2>
                <div id="icpContent" class="mt-3"></div>
            </div>
            
            <!-- Container for Detailed Analysis Cards -->
            <div id="detailedAnalysisCards" class="mt-3"></div>

            <!-- Detailed Category Cards (Generated by JS) -->
            <div id="detailedCards"></div>
        </div>
    </div>

    <!-- Popup Overlay for Score Details -->
    <div id="detailsPopupOverlay" class="popup-overlay">
        <div class="popup-container details-popup">
            <button id="detailsPopupClose" class="popup-close">&times;</button>
            <h2 id="detailsPopupTitle">Category Details</h2>
            <div id="detailsPopupContent">
                <p><strong>Score:</strong> <span id="detailsPopupScore"></span>/10</p>
                <p><strong>Analysis:</strong></p>
                <p id="detailsPopupAnalysis"></p>
                <p><strong>Recommendations:</strong></p>
                <p id="detailsPopupRecommendations"></p>
            </div>
        </div>
    </div>

    <!-- Popup Overlay for Gated Content -->


    <script src="js/config.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>

    <!-- Popup Form -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-container">
            <button class="popup-close" id="popupClose">&times;</button>

            <!-- Success notification -->
            <div class="success-notification" id="successNotification">
                Awesome! Your guide is on its way to your inbox üì©
            </div>

            <!-- Success container (shown after successful submission) -->
            <div class="success-container" id="successContainer">
                <h2>Thank You!</h2>
                <p>Check your email for the full report.</p>
            </div>

            <!-- Funnel Content (Stages) -->
            <div id="funnelContent">
                <!-- Stage 1: What's your business? -->
                <div id="stage1" class="funnel-stage active">
                    <div class="stage-indicator">1/4</div>
                    <h1>What's your business?</h1>
                    <div class="options-container">
                        <button class="option-button" data-stage="1" data-next="stage2" data-field="business_type" data-value="Agency"><span class="emoji">üíé</span> Agency</button>
                        <button class="option-button" data-stage="1" data-next="stage2" data-field="business_type" data-value="SaaS"><span class="emoji">üåê</span> SaaS</button>
                        <button class="option-button" data-stage="1" data-next="stage2" data-field="business_type" data-value="Service"><span class="emoji">üí¨</span> Service</button>
                        <button class="option-button" data-stage="1" data-next="stage2" data-field="business_type" data-value="Other"><span class="emoji">üëÄ</span> Other</button>
                    </div>
                </div>

                <!-- Stage 2: What's your biggest challenge with content marketing? -->
                <div id="stage2" class="funnel-stage">
                    <div class="stage-indicator">2/4</div>
                    <h1>What's your biggest challenge with content marketing?</h1>
                    <div class="options-container">
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="Finding time to create enough"><span class="emoji">‚è∞</span> Finding time to create enough</button>
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="Maintaining consistent quality"><span class="emoji">‚ú®</span> Maintaining consistent quality</button>
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="Creating personalized content"><span class="emoji">üë§</span> Creating personalized content</button>
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="Measuring content ROI"><span class="emoji">üìä</span> Measuring content ROI</button>
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="Scaling across multiple channels"><span class="emoji">üîÑ</span> Scaling across multiple channels</button>
                        <button class="option-button" data-stage="2" data-next="stage3" data-field="content_challenge" data-value="We don't prioritize content"><span class="emoji">ü§∑</span> We don't prioritize content</button>
                    </div>
                </div>

                <!-- Stage 3: What's your annual revenue? -->
                <div id="stage3" class="funnel-stage">
                    <div class="stage-indicator">3/4</div>
                    <h1>What's your annual revenue?</h1>
                    <div class="options-container">
                        <button class="option-button" data-stage="3" data-next="stage4" data-field="annual_revenue" data-value="Under $500K annually"><span class="emoji">üöÄ</span> Under $500K annually</button>
                        <button class="option-button" data-stage="3" data-next="stage4" data-field="annual_revenue" data-value="$500K - $1M annually"><span class="emoji">üí∞</span> $500K - $1M annually</button>
                        <button class="option-button" data-stage="3" data-next="stage4" data-field="annual_revenue" data-value="$1M - $5M annually"><span class="emoji">üíµ</span> $1M - $5M annually</button>
                        <button class="option-button" data-stage="3" data-next="stage4" data-field="annual_revenue" data-value="$5M - $10M annually"><span class="emoji">üå≤</span> $5M - $10M annually</button>
                        <button class="option-button" data-stage="3" data-next="stage4" data-field="annual_revenue" data-value="Over $50M annually"><span class="emoji">üè¢</span> Over $50M annually</button>
                    </div>
                </div>

                <!-- Stage 4: Contact Information -->
                <div id="stage4" class="funnel-stage">
                    <div class="stage-indicator">4/4</div>
                    <h1>Where Can We Send The Report?</h1>
                    <div class="form-container">
                        <form id="contactForm">
                            <div class="form-field">
                                <input type="text" id="name" name="name" placeholder="Your first and last name" required>
                            </div>
                            <div class="form-field">
                                <input type="email" id="email" name="email" placeholder="Your best email" required>
                            </div>
                            <div class="form-field">
                                <label for="phone" style="display:block; margin-bottom: 5px; font-size: 0.9rem; color: #555;">Phone (Optional):</label>
                                <div class="phone-input-container">
                                    <select id="countryCode" name="countryCode" class="country-code-select" required>
                                        <option value="+1" selected>United States (+1)</option>
                                        <option value="+44">United Kingdom (+44)</option>
                                        <!-- Add other country codes as needed, abbreviated for brevity -->
                                        <option value="+93">Afghanistan (+93)</option>
                                        <option value="+355">Albania (+355)</option>
                                        <option value="+213">Algeria (+213)</option>
                                        <option value="+1684">American Samoa (+1684)</option>
                                        <option value="+376">Andorra (+376)</option>
                                        <option value="+244">Angola (+244)</option>
                                        <option value="+1264">Anguilla (+1264)</option>
                                        <option value="+1268">Antigua & Barbuda (+1268)</option>
                                        <option value="+54">Argentina (+54)</option>
                                        <option value="+374">Armenia (+374)</option>
                                        <option value="+297">Aruba (+297)</option>
                                        <option value="+61">Australia (+61)</option>
                                        <option value="+43">Austria (+43)</option>
                                        <option value="+994">Azerbaijan (+994)</option>
                                        <option value="+1242">Bahamas (+1242)</option>
                                        <option value="+973">Bahrain (+973)</option>
                                        <option value="+880">Bangladesh (+880)</option>
                                        <option value="+1246">Barbados (+1246)</option>
                                        <option value="+375">Belarus (+375)</option>
                                        <option value="+32">Belgium (+32)</option>
                                        <option value="+501">Belize (+501)</option>
                                        <option value="+229">Benin (+229)</option>
                                        <option value="+1441">Bermuda (+1441)</option>
                                        <option value="+975">Bhutan (+975)</option>
                                        <option value="+591">Bolivia (+591)</option>
                                        <option value="+387">Bosnia & Herzegovina (+387)</option>
                                        <option value="+267">Botswana (+267)</option>
                                        <option value="+55">Brazil (+55)</option>
                                        <option value="+246">British Indian Ocean Territory (+246)</option>
                                        <option value="+1284">British Virgin Islands (+1284)</option>
                                        <option value="+673">Brunei (+673)</option>
                                        <option value="+359">Bulgaria (+359)</option>
                                        <option value="+226">Burkina Faso (+226)</option>
                                        <option value="+257">Burundi (+257)</option>
                                        <option value="+855">Cambodia (+855)</option>
                                        <option value="+237">Cameroon (+237)</option>
                                        <option value="+1">Canada (+1)</option>
                                        <option value="+238">Cape Verde (+238)</option>
                                        <option value="+1345">Cayman Islands (+1345)</option>
                                        <option value="+236">Central African Republic (+236)</option>
                                        <option value="+235">Chad (+235)</option>
                                        <option value="+56">Chile (+56)</option>
                                        <option value="+86">China (+86)</option>
                                        <option value="+57">Colombia (+57)</option>
                                        <option value="+269">Comoros (+269)</option>
                                        <option value="+242">Congo - Brazzaville (+242)</option>
                                        <option value="+243">Congo - Kinshasa (+243)</option>
                                        <option value="+682">Cook Islands (+682)</option>
                                        <option value="+506">Costa Rica (+506)</option>
                                        <option value="+225">C√¥te d‚ÄôIvoire (+225)</option>
                                        <option value="+385">Croatia (+385)</option>
                                        <option value="+53">Cuba (+53)</option>
                                        <option value="+599">Cura√ßao (+599)</option>
                                        <option value="+357">Cyprus (+357)</option>
                                        <option value="+420">Czechia (+420)</option>
                                        <option value="+45">Denmark (+45)</option>
                                        <option value="+253">Djibouti (+253)</option>
                                        <option value="+1767">Dominica (+1767)</option>
                                        <option value="+1">Dominican Republic (+1)</option>
                                        <option value="+593">Ecuador (+593)</option>
                                        <option value="+20">Egypt (+20)</option>
                                        <option value="+503">El Salvador (+503)</option>
                                        <option value="+240">Equatorial Guinea (+240)</option>
                                        <option value="+291">Eritrea (+291)</option>
                                        <option value="+372">Estonia (+372)</option>
                                        <option value="+251">Ethiopia (+251)</option>
                                        <option value="+500">Falkland Islands (+500)</option>
                                        <option value="+298">Faroe Islands (+298)</option>
                                        <option value="+679">Fiji (+679)</option>
                                        <option value="+358">Finland (+358)</option>
                                        <option value="+33">France (+33)</option>
                                        <option value="+594">French Guiana (+594)</option>
                                        <option value="+689">French Polynesia (+689)</option>
                                        <option value="+241">Gabon (+241)</option>
                                        <option value="+220">Gambia (+220)</option>
                                        <option value="+995">Georgia (+995)</option>
                                        <option value="+49">Germany (+49)</option>
                                        <option value="+233">Ghana (+233)</option>
                                        <option value="+350">Gibraltar (+350)</option>
                                        <option value="+30">Greece (+30)</option>
                                        <option value="+299">Greenland (+299)</option>
                                        <option value="+1473">Grenada (+1473)</option>
                                        <option value="+590">Guadeloupe (+590)</option>
                                        <option value="+1671">Guam (+1671)</option>
                                        <option value="+502">Guatemala (+502)</option>
                                        <option value="+44">Guernsey (+44)</option>
                                        <option value="+224">Guinea (+224)</option>
                                        <option value="+245">Guinea-Bissau (+245)</option>
                                        <option value="+592">Guyana (+592)</option>
                                        <option value="+509">Haiti (+509)</option>
                                        <option value="+504">Honduras (+504)</option>
                                        <option value="+852">Hong Kong (+852)</option>
                                        <option value="+36">Hungary (+36)</option>
                                        <option value="+354">Iceland (+354)</option>
                                        <option value="+91">India (+91)</option>
                                        <option value="+62">Indonesia (+62)</option>
                                        <option value="+98">Iran (+98)</option>
                                        <option value="+964">Iraq (+964)</option>
                                        <option value="+353">Ireland (+353)</option>
                                        <option value="+44">Isle of Man (+44)</option>
                                        <option value="+972">Israel (+972)</option>
                                        <option value="+39">Italy (+39)</option>
                                        <option value="+1">Jamaica (+1)</option>
                                        <option value="+81">Japan (+81)</option>
                                        <option value="+44">Jersey (+44)</option>
                                        <option value="+962">Jordan (+962)</option>
                                        <option value="+7">Kazakhstan (+7)</option>
                                        <option value="+254">Kenya (+254)</option>
                                        <option value="+686">Kiribati (+686)</option>
                                        <option value="+383">Kosovo (+383)</option>
                                        <option value="+965">Kuwait (+965)</option>
                                        <option value="+996">Kyrgyzstan (+996)</option>
                                        <option value="+856">Laos (+856)</option>
                                        <option value="+371">Latvia (+371)</option>
                                        <option value="+961">Lebanon (+961)</option>
                                        <option value="+266">Lesotho (+266)</option>
                                        <option value="+231">Liberia (+231)</option>
                                        <option value="+218">Libya (+218)</option>
                                        <option value="+423">Liechtenstein (+423)</option>
                                        <option value="+370">Lithuania (+370)</option>
                                        <option value="+352">Luxembourg (+352)</option>
                                        <option value="+853">Macau (+853)</option>
                                        <option value="+389">Macedonia (FYROM) (+389)</option>
                                        <option value="+261">Madagascar (+261)</option>
                                        <option value="+265">Malawi (+265)</option>
                                        <option value="+60">Malaysia (+60)</option>
                                        <option value="+960">Maldives (+960)</option>
                                        <option value="+223">Mali (+223)</option>
                                        <option value="+356">Malta (+356)</option>
                                        <option value="+692">Marshall Islands (+692)</option>
                                        <option value="+596">Martinique (+596)</option>
                                        <option value="+222">Mauritania (+222)</option>
                                        <option value="+230">Mauritius (+230)</option>
                                        <option value="+262">Mayotte (+262)</option>
                                        <option value="+52">Mexico (+52)</option>
                                        <option value="+691">Micronesia (+691)</option>
                                        <option value="+373">Moldova (+373)</option>
                                        <option value="+377">Monaco (+377)</option>
                                        <option value="+976">Mongolia (+976)</option>
                                        <option value="+382">Montenegro (+382)</option>
                                        <option value="+1664">Montserrat (+1664)</option>
                                        <option value="+212">Morocco (+212)</option>
                                        <option value="+258">Mozambique (+258)</option>
                                        <option value="+95">Myanmar (Burma) (+95)</option>
                                        <option value="+264">Namibia (+264)</option>
                                        <option value="+674">Nauru (+674)</option>
                                        <option value="+977">Nepal (+977)</option>
                                        <option value="+31">Netherlands (+31)</option>
                                        <option value="+599">Netherlands Antilles (+599)</option>
                                        <option value="+687">New Caledonia (+687)</option>
                                        <option value="+64">New Zealand (+64)</option>
                                        <option value="+505">Nicaragua (+505)</option>
                                        <option value="+227">Niger (+227)</option>
                                        <option value="+234">Nigeria (+234)</option>
                                        <option value="+683">Niue (+683)</option>
                                        <option value="+672">Norfolk Island (+672)</option>
                                        <option value="+850">North Korea (+850)</option>
                                        <option value="+1670">Northern Mariana Islands (+1670)</option>
                                        <option value="+47">Norway (+47)</option>
                                        <option value="+968">Oman (+968)</option>
                                        <option value="+92">Pakistan (+92)</option>
                                        <option value="+680">Palau (+680)</option>
                                        <option value="+970">Palestine (+970)</option>
                                        <option value="+507">Panama (+507)</option>
                                        <option value="+675">Papua New Guinea (+675)</option>
                                        <option value="+595">Paraguay (+595)</option>
                                        <option value="+51">Peru (+51)</option>
                                        <option value="+63">Philippines (+63)</option>
                                        <option value="+48">Poland (+48)</option>
                                        <option value="+351">Portugal (+351)</option>
                                        <option value="+1">Puerto Rico (+1)</option>
                                        <option value="+974">Qatar (+974)</option>
                                        <option value="+262">R√©union (+262)</option>
                                        <option value="+40">Romania (+40)</option>
                                        <option value="+7">Russia (+7)</option>
                                        <option value="+250">Rwanda (+250)</option>
                                        <option value="+590">Saint Barth√©lemy (+590)</option>
                                        <option value="+290">Saint Helena (+290)</option>
                                        <option value="+1869">Saint Kitts & Nevis (+1869)</option>
                                        <option value="+1758">Saint Lucia (+1758)</option>
                                        <option value="+590">Saint Martin (+590)</option>
                                        <option value="+508">Saint Pierre & Miquelon (+508)</option>
                                        <option value="+1784">St Vincent & Grenadines (+1784)</option>
                                        <option value="+685">Samoa (+685)</option>
                                        <option value="+378">San Marino (+378)</option>
                                        <option value="+239">S√£o Tom√© & Pr√≠ncipe (+239)</option>
                                        <option value="+966">Saudi Arabia (+966)</option>
                                        <option value="+221">Senegal (+221)</option>
                                        <option value="+381">Serbia (+381)</option>
                                        <option value="+248">Seychelles (+248)</option>
                                        <option value="+232">Sierra Leone (+232)</option>
                                        <option value="+65">Singapore (+65)</option>
                                        <option value="+1721">Sint Maarten (+1721)</option>
                                        <option value="+421">Slovakia (+421)</option>
                                        <option value="+386">Slovenia (+386)</option>
                                        <option value="+677">Solomon Islands (+677)</option>
                                        <option value="+252">Somalia (+252)</option>
                                        <option value="+27">South Africa (+27)</option>
                                        <option value="+500">South Georgia & South Sandwich Islands (+500)</option>
                                        <option value="+82">South Korea (+82)</option>
                                        <option value="+211">South Sudan (+211)</option>
                                        <option value="+34">Spain (+34)</option>
                                        <option value="+94">Sri Lanka (+94)</option>
                                        <option value="+249">Sudan (+249)</option>
                                        <option value="+597">Suriname (+597)</option>
                                        <option value="+47">Svalbard & Jan Mayen (+47)</option>
                                        <option value="+268">Swaziland (+268)</option>
                                        <option value="+46">Sweden (+46)</option>
                                        <option value="+41">Switzerland (+41)</option>
                                        <option value="+963">Syria (+963)</option>
                                        <option value="+886">Taiwan (+886)</option>
                                        <option value="+992">Tajikistan (+992)</option>
                                        <option value="+255">Tanzania (+255)</option>
                                        <option value="+66">Thailand (+66)</option>
                                        <option value="+670">Timor-Leste (+670)</option>
                                        <option value="+228">Togo (+228)</option>
                                        <option value="+690">Tokelau (+690)</option>
                                        <option value="+676">Tonga (+676)</option>
                                        <option value="+1868">Trinidad & Tobago (+1868)</option>
                                        <option value="+216">Tunisia (+216)</option>
                                        <option value="+90">Turkey (+90)</option>
                                        <option value="+993">Turkmenistan (+993)</option>
                                        <option value="+1649">Turks & Caicos Islands (+1649)</option>
                                        <option value="+688">Tuvalu (+688)</option>
                                        <option value="+1340">U.S. Virgin Islands (+1340)</option>
                                        <option value="+256">Uganda (+256)</option>
                                        <option value="+380">Ukraine (+380)</option>
                                        <option value="+971">United Arab Emirates (+971)</option>
                                        <option value="+598">Uruguay (+598)</option>
                                        <option value="+998">Uzbekistan (+998)</option>
                                        <option value="+678">Vanuatu (+678)</option>
                                        <option value="+379">Vatican City (+379)</option>
                                        <option value="+58">Venezuela (+58)</option>
                                        <option value="+84">Vietnam (+84)</option>
                                        <option value="+681">Wallis & Futuna (+681)</option>
                                        <option value="+212">Western Sahara (+212)</option>
                                        <option value="+967">Yemen (+967)</option>
                                        <option value="+260">Zambia (+260)</option>
                                        <option value="+263">Zimbabwe (+263)</option>
                                        </select>
                                    <input type="tel" id="phone" name="phone" placeholder="Phone number" class="input-field phone-input">
                                </div>
                            </div>
                            <button type="submit" class="submit-button">Get the Full Report!</button>
                        </form>
                    </div>
                </div>
            </div> <!-- End Funnel Content -->
        </div>
    </div>

</body>

<script src="js/script.js">

// API Interaction Functions

async function fetchAnalysis(url) {
    console.log(`Attempting to fetch analysis for: ${url}`);
    
    try {
        const response = await fetch(Config.webhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ url: url })
        });

        console.log(`Received response with status: ${response.status}`);
        if (!response.ok) {
            // Try to get error details from response body if possible
            let errorBody = 'Could not retrieve error details.';
            try {
                 errorBody = await response.text();
            } catch (e) { /* Ignore if reading body fails */ }
            throw new Error(`Network response was not ok: ${response.status} ${response.statusText}. Body: ${errorBody}`);
        }

        // Get response text instead of directly parsing as JSON
        const responseText = await response.text();
        
        // Sanitize the JSON string to remove invalid control characters
        const sanitizedJson = responseText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '') // Remove control characters
            .replace(/\\(?!["bfnrtu\\])/g, '\\\\'); // Escape backslashes not followed by valid escape chars
        
        try {
            // Parse the sanitized JSON
            const json = JSON.parse(sanitizedJson);
            console.log('Successfully parsed JSON response after sanitization');
            return json; // Return the parsed JSON data
        } catch (parseError) {
            console.error('JSON parsing error after sanitization:', parseError);
            // If still fails, try a more aggressive sanitization approach
            const aggressiveSanitized = responseText.replace(/[^\x20-\x7E]/g, '');
            try {
                const json = JSON.parse(aggressiveSanitized);
                console.log('Successfully parsed JSON with aggressive sanitization');
                return json;
            } catch (e) {
                throw new Error(`Failed to parse JSON after sanitization: ${parseError.message}`);
            }
        }

    } catch (error) {
        console.error('Detailed error fetching or processing roast data:', error);
        // Re-throw the error so the caller (main.js) knows it failed
        throw new Error(`Failed to fetch or process analysis: ${error.message}`); 
    }
}


// Configuration settings

const Config = {
    webhookUrl: 'https://hook.eu2.make.com/fifbpm3zs7gw23j6wky83jkmbskv1xf1',
    
    // Category mapping (full API name to short display name)
    CATEGORY_MAP: {
        'Clarity_and_Value_Proposition_(MECLABS_C_StoryBrand)': 'Clarity & Value',
        'Motivation_and_Persuasion_(AIDA_InterestDesire_MECLABS_M)': 'Motivation',
        'Trust_and_Credibility_(MECLABS_A_SocialProof)': 'Trust',
        'Call_to_Action_Effectiveness_(AIDA_Action_MECLABS_I)': 'CTA Effectiveness',
        'User_Experience_and_Usability_(Heuristics_MECLABS_F)': 'UX & Usability',
        'Overall_Narrative_and_Flow_(AIDA_Flow_StoryBrand)': 'Narrative Flow'
    },

    // Categories expected to have scores for the summary circles
    scoredCategories: [
        'Clarity_and_Value_Proposition_(MECLABS_C_StoryBrand)',
        'Motivation_and_Persuasion_(AIDA_InterestDesire_MECLABS_M)',
        'Trust_and_Credibility_(MECLABS_A_SocialProof)',
        'Call_to_Action_Effectiveness_(AIDA_Action_MECLABS_I)',
        'User_Experience_and_Usability_(Heuristics_MECLABS_F)',
        'Overall_Narrative_and_Flow_(AIDA_Flow_StoryBrand)'
    ]
};

// Freeze the object to prevent accidental modification
Object.freeze(Config);
Object.freeze(Config.CATEGORY_MAP);
Object.freeze(Config.scoredCategories);

// Main application logic: Event listeners and coordination

document.addEventListener('DOMContentLoaded', () => {
    // --- Get DOM Elements --- 
    const elements = {
        roastForm: document.getElementById('roastForm'),
        urlInput: document.getElementById('urlInput'),
        errorMessage: document.getElementById('errorMessage'),
        loading: document.getElementById('loading'),
        results: document.getElementById('results'),
        roastContent: document.getElementById('roastContent'),
        icpContent: document.getElementById('icpContent'),
        overallScore: document.getElementById('overallScore'),
        categoryScoreCards: document.querySelector('.category-score-cards'),
        detailedCards: document.getElementById('detailedCards'), // If you add detailed cards later
        detailedAnalysisCards: document.getElementById('detailedAnalysisCards'), // Container for new detailed cards
        // Share Buttons
        shareTwitter: document.getElementById('shareTwitter'),
        shareFacebook: document.getElementById('shareFacebook'),
        shareLinkedIn: document.getElementById('shareLinkedIn'),
        shareEmail: document.getElementById('shareEmail'),
        // Details Popup
        detailsPopupOverlay: document.getElementById('detailsPopupOverlay'),
        detailsPopupClose: document.getElementById('detailsPopupClose'),
        detailsPopupTitle: document.getElementById('detailsPopupTitle'),
        detailsPopupScore: document.getElementById('detailsPopupScore'),
        detailsPopupAnalysis: document.getElementById('detailsPopupAnalysis'),
        detailsPopupRecommendations: document.getElementById('detailsPopupRecommendations'),
        // Gated Content Popup (Add elements if implemented)
        popupOverlay: document.getElementById('popupOverlay'),
        popupClose: document.getElementById('popupClose'),
        // ... add other funnel form elements if needed ...
    };

    let currentRoastData = { roastText: '', analyzedUrl: '' }; // Store current results for sharing

    // Provide elements to the UI module
    setDOMElements(elements);

    let lastAnalysisData = null; // Store the last successful analysis

    // --- Event Listeners --- 

    // Form Submission
    elements.roastForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const url = elements.urlInput.value.trim();

        if (!isValidUrl(url)) {
            showError('Please enter a valid URL (e.g., https://example.com)');
            return;
        }

        showLoading();
        lastAnalysisData = null; // Clear previous data on new submission

        try {
            const data = await fetchAnalysis(url);
            lastAnalysisData = data; // Store data on success

            // Store data for sharing
            const roastResult = data.analysis_results.find(r => r.category === 'Roast'); // Match exact case from JSON
            currentRoastData.roastText = roastResult ? roastResult.roast : 'No roast available.';
            currentRoastData.analyzedUrl = url;

            // --- Render Results --- 
            if (data && data.analysis_results) {
                // 1. Find Roast and ICP
                const roastResult = data.analysis_results.find(r => r.category === 'Roast');
                const icpResult = data.analysis_results.find(r => r.category === 'ICP');
                renderRoast(roastResult ? roastResult.roast : null);
                renderICP(icpResult ? icpResult.icp_description : null);
                
                // 1.5 Display screenshot if available
                if (data.screenshot_url) {
                    console.log('Screenshot URL found:', data.screenshot_url);
                    const screenshotImg = document.getElementById('homepageScreenshot');
                    if (screenshotImg) {
                        screenshotImg.src = data.screenshot_url;
                        screenshotImg.style.display = 'block';
                    }
                } else {
                    console.log('No screenshot URL in response');
                    const screenshotImg = document.getElementById('homepageScreenshot');
                    if (screenshotImg) {
                        screenshotImg.style.display = 'none';
                    }
                }

                // 2. Render Summary Score Cards (this also calculates and renders overall score)
                renderSummaryScoreCards(data.analysis_results);
                
                // 3. Render Detailed Analysis Cards
                renderDetailedAnalysisCards(data.analysis_results);

                // 4. Add Listeners for "Get Full Report" buttons
                addGatingButtonListeners();

                // 5. Animate Circles & Add Click Listeners (AFTER elements are in DOM)
                addScoreCircleInteractions();

                elements.results.style.display = 'block'; // Show results container

                console.log('Analysis displayed successfully.');
                
            } else {
                 throw new Error('Received data is not in the expected format.');
            }

        } catch (error) {
            console.error('Error during analysis fetch or rendering:', error);
            showError(`Analysis failed: ${error.message}`);
            clearResults(); // Ensure results area is cleared on error
        } finally {
            hideLoading();
        }
    });

    // --- Share Button Listeners --- 
    setupShareButtons();

    // --- Details Popup Listeners --- 
    setupDetailsPopup();

    // --- Gated Content Popup Listeners --- 
    // initPopup(); // Call this if you uncomment/add popup logic back from original file

     // --- Helper Functions Specific to main.js --- 
 
     // Function to add listeners and animation AFTER score circles are rendered
    function addScoreCircleInteractions() {
        const circleElements = elements.categoryScoreCards.querySelectorAll('.circle-indicator');
        circleElements.forEach(circleElem => {
            const score = parseFloat(circleElem.dataset.animateScore); // Get score saved earlier
            if (!isNaN(score)) {
                animateCircle(circleElem, score, 1000); // Animate the circle
            }

            // Add click listener to scroll to the corresponding detailed card
            circleElem.addEventListener('click', () => {
                const categoryName = circleElem.dataset.categoryName;
                if (categoryName) {
                    // Find the corresponding detailed card
                    const detailedCards = document.querySelectorAll('.detailed-analysis-card');
                    let targetCard = null;
                    
                    detailedCards.forEach(card => {
                        const titleElem = card.querySelector('.category-title');
                        if (titleElem && titleElem.textContent.includes(categoryName)) {
                            targetCard = card;
                        }
                    });
                    
                    if (targetCard) {
                        // Scroll to the card with smooth behavior
                        targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        
                        // Optional: Add a highlight effect
                        targetCard.classList.add('highlight-card');
                        setTimeout(() => {
                            targetCard.classList.remove('highlight-card');
                        }, 2000);
                    }
                }
            });
        });
    }

    // Animation helper (easeOutCubic)
    function easeOutCubic(t) { 
        return 1 - Math.pow(1 - t, 3); 
    }

    // Animate number counter and arc
    function animateCircle(circleElem, finalScore, duration) {
        const valueElem = circleElem.querySelector('.score-value');
        const progressElem = circleElem.querySelector('.progress');
        if (!valueElem || !progressElem) {
            console.error('Could not find value or progress element for animation');
            return;
        }
        const radius = 54; // Must match the SVG radius
        const circumference = 2 * Math.PI * radius;
        let start = null;
        
        // Reset before starting
        valueElem.textContent = '0';
        progressElem.setAttribute('stroke-dashoffset', circumference);
        progressElem.style.transition = 'stroke-dashoffset 0s'; // Disable CSS transition during JS animation

        function animate(ts) {
            if (!start) start = ts;
            let elapsed = ts - start;
            let progress = Math.min(elapsed / duration, 1);
            let eased = easeOutCubic(progress);
            let currentScore = Math.round(eased * finalScore);
            
            valueElem.textContent = currentScore;
            
            let percent = (currentScore / 10); // Assuming max score is 10
            let offset = circumference * (1 - percent);
            progressElem.setAttribute('stroke-dashoffset', offset);

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                // Ensure final values are exact
                valueElem.textContent = finalScore;
                let finalOffset = circumference * (1 - (finalScore / 10));
                progressElem.setAttribute('stroke-dashoffset', finalOffset);
            }
        }
        requestAnimationFrame(animate);
    }

    // --- Gating Logic --- 
    function addGatingButtonListeners() {
        const buttons = elements.detailedAnalysisCards.querySelectorAll('.get-full-report-btn');
        buttons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent potential form submission if wrapped
                // Show the main popup overlay (assuming it contains the form)
                if (elements.popupOverlay) {
                    elements.popupOverlay.style.display = 'flex';
                } else {
                    console.error('Popup overlay element not found.');
                }
            });
        });
    }

    // Details Popup Logic
    function openDetailsPopup(category, score, analysis, recommendations) {
        elements.detailsPopupTitle.textContent = category || 'Details';
        elements.detailsPopupScore.textContent = score !== '?' ? score : 'N/A';
        elements.detailsPopupAnalysis.textContent = analysis || 'No analysis provided.';
        elements.detailsPopupRecommendations.textContent = recommendations || 'No recommendations provided.';
        elements.detailsPopupOverlay.style.display = 'flex';
    }

    function closeDetailsPopup() {
        elements.detailsPopupOverlay.style.display = 'none';
    }
    
    function setupDetailsPopup() {
        if(elements.detailsPopupClose) {
            elements.detailsPopupClose.addEventListener('click', closeDetailsPopup);
        }
        if(elements.detailsPopupOverlay) {
            // Close if clicking outside the popup content
            elements.detailsPopupOverlay.addEventListener('click', (event) => {
                if (event.target === elements.detailsPopupOverlay) {
                    closeDetailsPopup();
                }
            });
        }
    }

    // Share Button Logic 
    function setupShareButtons() {
        // Only keeping Twitter/X sharing functionality
        if (elements.shareTwitter) {
            elements.shareTwitter.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentRoastData.analyzedUrl && currentRoastData.roastText) {
                    // Get the overall score from lastAnalysisData
                    let overallScore = '?';
                    if (lastAnalysisData) {
                        // Calculate the average score of all categories
                        const scores = lastAnalysisData.analysis_results
                            .filter(item => typeof item.score === 'number')
                            .map(item => item.score);
                        
                        if (scores.length > 0) {
                            const average = scores.reduce((sum, score) => sum + score, 0) / scores.length;
                            overallScore = average.toFixed(1);
                        }
                    }
                    
                    // Format the share text according to the exact example
                    // Including the full roast text without truncation
                    const fullRoast = currentRoastData.roastText || '';
                    
                    const text = encodeURIComponent(
                        `I just got my homepage roasted (URL: ${currentRoastData.analyzedUrl})\n\n` +
                        `Score: ${overallScore}/10\n\n` +
                        `"${fullRoast}"\n\n` +
                        `Check out https://www.freshbread.ai/downloads/roast-my-homepage`
                    );
                    
                    // Don't include the URL as a separate parameter
                    const tweetUrl = `https://twitter.com/intent/tweet?text=${text}`;
                    console.log('Share URL:', decodeURIComponent(text)); // For debugging
                    window.open(tweetUrl, '_blank', 'noopener,noreferrer');
                } else {
                    alert('Please analyze a URL first to share the results.');
                }
            });
        }
    }

    console.log("Homepage Roast App Initialized");

    // --- Multi-Stage Popup Logic ---
    const popupOverlay = document.getElementById('popupOverlay');
    const popupContainer = document.getElementById('popupContainer');
    const closePopupButton = document.getElementById('popupClose');
    const funnelStages = document.querySelectorAll('.funnel-stage');
    const funnelContent = document.getElementById('funnelContent'); // Container for stages
    const successNotification = document.getElementById('successNotification');
    const successContainer = document.getElementById('successContainer'); // Container for success message
    const finalForm = document.getElementById('contactForm'); // Stage 4 form
    const stageIndicator = document.getElementById('stageIndicator');

    let currentStageIndex = 0;
    const totalStages = 4; // Total number of input stages (excluding success)
    const formData = {
        businessType: '',
        contentChallenges: '',
        annualRevenue: '',
        name: '',
        email: '',
        phone: '',
        countryCode: ''
    };

    function updateStageIndicator() {
        if (stageIndicator) {
            stageIndicator.textContent = `Step ${currentStageIndex + 1} of ${totalStages}`;
        }
         // Hide indicator on the final form stage or success stage
        if (stageIndicator) {
            stageIndicator.style.display = (currentStageIndex >= totalStages -1 ) ? 'none' : 'block';
        }
    }


    function showStage(stageIndex) {
        funnelStages.forEach((stage, index) => {
            stage.classList.toggle('active', index === stageIndex);
        });
        currentStageIndex = stageIndex;
        updateStageIndicator();

        // Reset scroll position for the new stage if needed
        const activeStage = funnelStages[stageIndex];
        if (activeStage) {
            activeStage.scrollTop = 0;
        }
        // Ensure main funnel content is visible and success is hidden
        funnelContent.style.display = 'block';
        successContainer.style.display = 'none';
        successNotification.style.display = 'none';
        popupContainer.classList.remove('success-mode');

    }

    function openPopup() {
        if (popupOverlay) {
            resetPopup(); // Reset to first stage every time it opens
            popupOverlay.style.display = 'flex';
             // Delay slightly to allow display:flex to apply before transition
            setTimeout(() => {
                // Add styles for smooth transition if defined in CSS
                // e.g., popupContainer.style.transform = 'scale(1)';
                // e.g., popupContainer.style.opacity = '1';
            }, 10);
        }
    }

    function closePopup() {
         if (popupOverlay) {
            // Add styles for smooth transition if defined in CSS
             // e.g., popupContainer.style.transform = 'scale(0.95)';
             // e.g., popupContainer.style.opacity = '0';
            // Wait for transition before hiding
            // setTimeout(() => {
                popupOverlay.style.display = 'none';
                resetPopup(); // Reset state after closing
            // }, 300); // Match transition duration if any
        }
    }

    function nextStage() {
        if (currentStageIndex < funnelStages.length - 1) {
            showStage(currentStageIndex + 1);
        }
    }

     function resetPopup() {
        formData.businessType = '';
        formData.contentChallenges = '';
        formData.annualRevenue = '';
        formData.name = '';
        formData.email = '';
        formData.phone = '';
        formData.countryCode = '';
        if(finalForm) finalForm.reset();
        // Select the default country code again if needed
        const countryCodeSelect = document.getElementById('countryCode');
        if (countryCodeSelect) {
            countryCodeSelect.value = '+1'; // Or your default
        }
        showStage(0); // Go back to the first stage
        // Ensure success message is hidden and funnel is shown
        funnelContent.style.display = 'block';
        successContainer.style.display = 'none';
        successNotification.style.display = 'none';
        popupContainer.classList.remove('success-mode');

    }

    function showSuccessState() {
        funnelContent.style.display = 'none'; // Hide form stages
        successContainer.style.display = 'flex'; // Show success message container
        successNotification.style.display = 'block'; // Show success banner
        popupContainer.classList.add('success-mode');
        // Optional: Auto-close after a few seconds
        // setTimeout(closePopup, 5000);
    }


    // Event Listener for Closing Popup
    if (closePopupButton) {
        closePopupButton.addEventListener('click', closePopup);
    }
    if (popupOverlay) {
        popupOverlay.addEventListener('click', (event) => {
            // Close only if clicked directly on the overlay, not the container itself
            if (event.target === popupOverlay) {
                closePopup();
            }
        });
    }

    // Event Listeners for Option Buttons (Stages 1-3)
    funnelStages.forEach((stage, index) => {
        if (index < 3) { // Only for stages 0, 1, 2 (Business Type, Challenges, Revenue)
            const optionButtons = stage.querySelectorAll('.option-button');
            optionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = button.dataset.value;
                    if (index === 0) formData.businessType = value;
                    else if (index === 1) formData.contentChallenges = value;
                    else if (index === 2) formData.annualRevenue = value;
                    console.log('Updated formData:', formData); // For debugging
                    nextStage();
                });
            });
        }
    });


    // Event Listener for Final Form Submission (Stage 4)
    if (finalForm) {
        finalForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission

            // Collect data from the final form
            formData.name = document.getElementById('name').value;
            formData.email = document.getElementById('email').value;
            formData.phone = document.getElementById('phone').value || ''; // Handle empty phone
            formData.countryCode = document.getElementById('countryCode').value;

            console.log('Submitting final form data:', formData); // For debugging

            // Show loading state on button
            const submitButton = finalForm.querySelector('.submit-button');
            if (submitButton) {
                submitButton.textContent = 'Submitting...';
                submitButton.disabled = true;
            }
                
            // Format data for webhook in the expected format
            const webhookData = {
                businessType: formData.businessType || 'Not specified',
                contentChallenge: formData.contentChallenges || 'Not specified',
                annualRevenue: formData.annualRevenue || 'Not specified',
                name: formData.name,
                email: formData.email,
                phone: formData.phone ? `${formData.countryCode} ${formData.phone}` : 'Not provided',
                url: currentRoastData.analyzedUrl || window.location.href // Include the analyzed URL or fallback to current page
            };
            
            console.log('Submitting to webhook:', webhookData);
            
            // Use setTimeout to ensure UI updates before trying the fetch
            setTimeout(async () => {
                // Always show success after a delay, regardless of actual submission result
                const showSuccess = () => {
                    setTimeout(() => {
                        showSuccessState();
                    }, 1000); // Small delay for better UX
                };
                
                // Attempt to send data but don't let failures affect the user experience
                try {
                    // Use no-cors mode to avoid CORS issues
                    const fetchOptions = {
                        method: 'POST',
                        mode: 'no-cors', // This prevents CORS errors but means we can't read the response
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(webhookData)
                    };
                    
                    // Send the data with a timeout to prevent hanging
                    const fetchPromise = fetch('https://hook.eu2.make.com/icfxtcjhrir2g5o1sfdfi8w4o0px1vy4', fetchOptions);
                    
                    // Set a timeout for the fetch
                    const timeoutPromise = new Promise((_, reject) => {
                        setTimeout(() => reject(new Error('Request timed out')), 5000);
                    });
                    
                    // Race the fetch against the timeout
                    await Promise.race([fetchPromise, timeoutPromise]);
                    console.log('Data sent to webhook');                
                } catch (error) {
                    // Log error but don't show to user
                    console.log('Error in submission (proceeding anyway):', error);
                    // Store in localStorage for retry later if needed
                    try {
                        const storedSubmissions = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
                        storedSubmissions.push(webhookData);
                        localStorage.setItem('pendingSubmissions', JSON.stringify(storedSubmissions));
                        console.log('Saved submission data for later retry');
                    } catch (storageError) {
                        console.error('Could not save to localStorage:', storageError);
                    }
                }
                
                // Always show success regardless of what happened with the submission
                showSuccess();
                
                // Reset button state after a delay
                setTimeout(() => {
                    if (submitButton) {
                        submitButton.textContent = 'Get the Full Report';
                        submitButton.disabled = false;
                    }
                }, 2000);
            }, 500);
        });
    }
    // --- End of Form Submit Handler ---

    // --- Add Trigger for Opening Popup (Example - replace with actual triggers) ---
    // This part needs to be connected to the "Get the full report" buttons
    // We will add those buttons and their listeners in the next step (editing ui.js)
    // Example: document.getElementById('someButtonId').addEventListener('click', openPopup);
    // Make openPopup globally accessible or attach it to window if needed by ui.js
    window.openReportPopup = openPopup; 


});

// UI Manipulation Functions

// DOM Element References (will be populated by main.js)
let DOMElements = {};

function setDOMElements(elements) {
    DOMElements = elements;
}

// --- Error Handling --- 
function showError(message) {
    if (!DOMElements.errorMessage) return;
    DOMElements.errorMessage.textContent = message;
    DOMElements.errorMessage.style.display = 'block';
}

function hideError() {
    if (!DOMElements.errorMessage) return;
    DOMElements.errorMessage.style.display = 'none';
}

// --- Loading State --- 
function showLoading() {
    clearResults(); 
    hideError();
    if (DOMElements.loading) {
        DOMElements.loading.style.display = 'block';
        DOMElements.loading.innerHTML = '<div class="spinner"></div><p>Analyzing your homepage... This may take up to 60 seconds.</p>';
    }
    if (DOMElements.results) DOMElements.results.style.display = 'none';
}

function hideLoading() {
    if (DOMElements.loading) DOMElements.loading.style.display = 'none';
}

// --- Result Display --- 
function clearResults() {
    // Clear dynamic content areas
    if (DOMElements.overallScore) DOMElements.overallScore.textContent = '0/10';
    if (DOMElements.categoryScoreCards) DOMElements.categoryScoreCards.innerHTML = '';
    if (DOMElements.roastContent) DOMElements.roastContent.textContent = '';
    if (DOMElements.icpContent) DOMElements.icpContent.textContent = '';
    if (DOMElements.detailedCards) DOMElements.detailedCards.innerHTML = ''; 
    if (DOMElements.detailedAnalysisCards) DOMElements.detailedAnalysisCards.innerHTML = ''; // Clear detailed cards too
    // Hide the results container itself
    if (DOMElements.results) DOMElements.results.style.display = 'none';
}

function showResultsContainer() {
    if (DOMElements.results) DOMElements.results.style.display = 'block';
}

// --- Specific Content Rendering --- 

function renderRoast(roastText) {
    if (DOMElements.roastContent) {
        DOMElements.roastContent.textContent = roastText || 'No roast available.';
    }
}

function renderICP(icpText) {
    if (DOMElements.icpContent) {
        DOMElements.icpContent.textContent = icpText || 'No ICP description available.';
    }
}

function renderOverallScore(score) {
    // Get references to the new elements
    const scoreTextElement = document.getElementById('overallScore'); // The text display
    const scoreContainer = document.querySelector('.score-container');
    const circlePath = scoreContainer ? scoreContainer.querySelector('path.circle') : null;

    if (scoreTextElement && scoreContainer && circlePath) {
        let numericScore = parseFloat(score);
        let displayScore = '?';
        let percentage = 0;
        let colorClass = 'score-grey'; // Default class

        if (!isNaN(numericScore) && numericScore >= 0 && numericScore <= 10) {
            displayScore = numericScore.toFixed(1);
            percentage = (numericScore / 10) * 100;

            // Determine color class
            if (numericScore <= 4) {
                colorClass = 'score-red';
            } else if (numericScore <= 7) {
                colorClass = 'score-orange';
            } else {
                colorClass = 'score-green';
            }
        } else {
            // Handle null, NaN, or out-of-range scores
            numericScore = null; // Explicitly null for logic below
            displayScore = '?';
            percentage = 0;
            colorClass = 'score-grey';
        }

        // Update Text
        scoreTextElement.textContent = `${displayScore}/10`;

        // Update SVG circle - the SVG has a full circumference of 339.29
        // We need to reduce the strokeDashoffset based on the percentage
        const circumference = 339.29; // Match the value in the SVG
        const offset = circumference - (percentage / 100) * circumference;
        circlePath.style.strokeDashoffset = offset;

        // Update Color Class on container
        scoreContainer.classList.remove('score-red', 'score-orange', 'score-green', 'score-grey');
        scoreContainer.classList.add(colorClass);

    } else {
        console.error('renderOverallScore Error: Could not find all necessary elements.');
        console.log('Element Check - scoreTextElement:', scoreTextElement); 
        console.log('Element Check - scoreContainer:', scoreContainer);
        console.log('Element Check - circlePath:', circlePath); 

        // Fallback or default state if elements are missing
        if (scoreTextElement) { 
            scoreTextElement.textContent = '?/10'; 
        } else {
            console.error('renderOverallScore Error: scoreTextElement (#overallScore) not found!');
        }
    }
}

// Helper to escape characters unsafe for HTML attributes
function escapeHtmlAttr(str) {
    if (typeof str !== 'string') return '';
    // Basic escaping for quotes and less-than/greater-than
    return str.replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

// Score color logic
function getScoreColorClass(score) {
    if (score === null || score === undefined) return 'grey'; // Handle missing scores
    if (score <= 4) return 'red';
    if (score <= 7) return 'orange';
    return 'green';
}

function renderSummaryScoreCards(analysisResults) {
    if (!DOMElements.categoryScoreCards || !analysisResults) return;

    DOMElements.categoryScoreCards.innerHTML = ''; // Clear previous cards
    let totalScore = 0;
    let scoredCount = 0;

    Config.scoredCategories.forEach(catKey => {
        const result = analysisResults.find(r => r.category === catKey);
        const score = result && typeof result.score === 'number' ? result.score : null;
        const analysis = result ? result.analysis : '';
        const recommendations = result ? result.recommendations : '';
        const displayName = Config.CATEGORY_MAP[catKey] || catKey; // Fallback to key if no map

        if (score !== null) {
            totalScore += score;
            scoredCount++;
        }

        const colorClass = getScoreColorClass(score);
        const scoreDisplay = score !== null ? score : '?'; // Use '?' for display if score is null

        const card = document.createElement('div');
        card.className = 'category-score-card';
        
        // Create the circle indicator SVG structure
        const circleSVG = `
        <div class="circle-indicator ${colorClass}" 
             data-score="${scoreDisplay}" 
             data-analysis="${escapeHtmlAttr(analysis)}" 
             data-recommendations="${escapeHtmlAttr(recommendations)}" 
             data-category-name="${escapeHtmlAttr(displayName)}"
             title="${escapeHtmlAttr(displayName)}: ${scoreDisplay}/10">
          <svg viewBox="0 0 120 120">
            <circle class="bg" cx="60" cy="60" r="54"/>
            <circle class="progress" cx="60" cy="60" r="54" stroke-dasharray="339.29" stroke-dashoffset="339.29"/>
          </svg>
          <span class="score-value">0</span>
        </div>
        <div class="category-name">${escapeHtmlAttr(displayName)}</div>
        `;
        
        card.innerHTML = circleSVG;
        DOMElements.categoryScoreCards.appendChild(card);

        // Add animation and popup listener (handled in main.js after element exists)
        const circleElem = card.querySelector('.circle-indicator');
        if (circleElem && score !== null) {
             // Store score on the element for animation retrieval
            circleElem.dataset.animateScore = score; 
        }
    });

    // Calculate and render overall score
    const overallAvg = scoredCount > 0 ? (totalScore / scoredCount) : null;
    console.log(`Calculated Overall Score: totalScore=${totalScore}, scoredCount=${scoredCount}, overallAvg=${overallAvg !== null ? overallAvg.toFixed(1) : 'N/A'}`); // DEBUG LOG
    renderOverallScore(overallAvg); 
}

// Helper function to format text as bullet points
function formatTextAsBullets(text) {
    if (!text || text === 'No analysis provided.' || text === 'No recommendations provided.') {
        return `<p>${escapeHtmlAttr(text)}</p>`;
    }
    
    // Split text into sentences (handling periods, question marks, exclamation points)
    // This regex looks for sentence endings followed by spaces or end of string
    const sentences = text.split(/(?<=[.!?])\s+|(?<=[.!?])$/)
        .filter(sentence => sentence.trim().length > 0);
    
    if (sentences.length === 0) {
        return `<p>${escapeHtmlAttr(text)}</p>`;
    }
    
    // Format as bullet points
    const bulletPoints = sentences.map(sentence => {
        // Trim the sentence and ensure it ends with proper punctuation
        let trimmedSentence = sentence.trim();
        if (!/[.!?]$/.test(trimmedSentence)) {
            trimmedSentence += '.';
        }
        return `<li>${escapeHtmlAttr(trimmedSentence)}</li>`;
    }).join('');
    
    return `<ul class="bullet-list">${bulletPoints}</ul>`;
}

// --- Detailed Analysis Card Rendering ---
function renderDetailedAnalysisCards(analysisResults) {
    if (!DOMElements.detailedAnalysisCards || !analysisResults) {
        console.error("Missing detailed analysis card container or results data");
        return;
    }

    const container = DOMElements.detailedAnalysisCards;
    container.innerHTML = ''; // Clear previous cards

    Config.scoredCategories.forEach(catKey => {
        const result = analysisResults.find(r => r.category === catKey);
        if (!result) return; // Skip if no data for this category

        const displayName = Config.CATEGORY_MAP[catKey] || catKey;
        const analysis = result.analysis || 'No analysis provided.';
        const recommendations = result.recommendations || 'No recommendations provided.';
        const score = typeof result.score === 'number' ? result.score : null;
        const scoreDisplay = score !== null ? `${score}/10` : 'N/A';

        const card = document.createElement('div');
        card.className = 'card detailed-analysis-card';

        // Use emoji instead of SVG based on category
        let iconEmoji = '';
        switch (displayName) {
            case 'Clarity & Value':
                iconEmoji = 'üí°';
                break;
            case 'Motivation':
                iconEmoji = 'üöÄ';
                break;
            case 'Trust':
                iconEmoji = 'ü§ù';
                break;
            case 'CTA Effectiveness':
                iconEmoji = 'üëâ';
                break;
            case 'UX & Usability':
                iconEmoji = 'üñ±Ô∏è';
                break;
            case 'Narrative Flow':
            case 'Overall Narrative & Flow':
                iconEmoji = 'üìù';
                break;
            default:
                iconEmoji = '';
        }

        // Set the inner HTML for the card structure
        card.innerHTML = `
            <div class="category-header">
                <span class="category-title">${iconEmoji} ${escapeHtmlAttr(displayName)}</span>
                <span class="category-score ${getScoreColorClass(score)}">${scoreDisplay}</span>
            </div>
            <div class="detailed-content">
                <div class="analysis-column">
                    <h4>Analysis</h4>
                    ${formatTextAsBullets(analysis)}
                </div>
                <div class="recommendation-column blurred">
                     <h4 class="not-blurred">How to Fix</h4>
                     <div class="blurred-content">${formatTextAsBullets(recommendations)}</div>
                     <div class="gating-overlay">
                         <i class="fas fa-lock lock-icon"></i>
                         <button class="cta-button get-full-report-btn">Get the full report</button>
                     </div>
                </div>
            </div>
        `;

        // Find the button within the newly created card
        const reportButton = card.querySelector('.get-full-report-btn');

        // Add the event listener to open the popup
        if (reportButton) {
            reportButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent potential card-level clicks if any
                if (typeof window.openReportPopup === 'function') {
                    window.openReportPopup();
                } else {
                    console.error('openReportPopup function not found on window.');
                    alert('Could not open the report form.');
                }
            });
        }

        // Append the fully constructed card to the container
        container.appendChild(card);
    });
}

// --- Simple Validation --- 
function isValidUrl(string) {
    try {
        new URL(string);
        return true;
    } catch (_) {
        return false;  
    }
}






</script>

</html>
